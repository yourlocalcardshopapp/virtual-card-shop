// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// User model - tracks player accounts and balances
model User {
  id                    String                @id @default(cuid())
  email                 String                @unique
  username              String                @unique
  displayName           String?
  balance               Float                 @default(50) // Players start with $50
  lastClaimTime         DateTime?             // Track when they last claimed money
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  inventory             UserInventory[]
  transactions          Transaction[]

  @@map("users")
}

// CardSet model - represents a sports card set (e.g., 2024 Topps Baseball)
model CardSet {
  id                    String                @id @default(cuid())
  name                  String                // e.g., "2024 Topps Baseball"
  sport                 String                // baseball, football, basketball, hockey
  year                  Int                   // Year the set was released
  description           String?
  totalCards            Int                   // Total number of cards in the set
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  boxes                 Box[]
  cards                 Card[]

  @@unique([sport, year, name])
  @@map("card_sets")
}

// Box model - represents a box of card packs (e.g., Box of 24 packs)
model Box {
  id                    String                @id @default(cuid())
  cardSetId             String
  cardSet               CardSet               @relation(fields: [cardSetId], references: [id], onDelete: Cascade)
  price                 Float                 // Price to purchase the box
  packsPerBox           Int                   // Number of packs in this box
  cardsPerPack          Int                   // Number of cards per pack
  quantity              Int                   // Quantity available in shop
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  packs                 Pack[]
  transactions          Transaction[]

  @@map("boxes")
}

// Pack model - represents a single pack of cards
model Pack {
  id                    String                @id @default(cuid())
  boxId                 String
  box                   Box                   @relation(fields: [boxId], references: [id], onDelete: Cascade)
  price                 Float                 // Price to purchase just this pack
  cardsPerPack          Int                   // Number of cards in this pack
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  cards                 Card[]
  transactions          Transaction[]

  @@map("packs")
}

// Card model - represents an individual sports card with real card data
model Card {
  id                    String                @id @default(cuid())
  cardSetId             String
  cardSet               CardSet               @relation(fields: [cardSetId], references: [id], onDelete: Cascade)
  packId                String?
  pack                  Pack?                 @relation(fields: [packId], references: [id], onDelete: SetNull)
  
  // Card data
  playerName            String                // e.g., "Mike Trout"
  playerTeam            String                // e.g., "Los Angeles Angels"
  cardNumber            String                // Card number in the set
  rarity                String                // common, uncommon, rare, etc.
  estimatedValue        Float                 // Estimated market value for buyback
  
  createdAt             DateTime              @default(now())
  updatedAt             DateTime              @updatedAt
  
  // Relations
  inventoryItems        UserInventory[]
  transactions          Transaction[]

  @@map("cards")
}

// UserInventory model - tracks cards owned by users
model UserInventory {
  id                    String                @id @default(cuid())
  userId                String
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  cardId                String
  card                  Card                  @relation(fields: [cardId], references: [id], onDelete: Cascade)
  
  quantity              Int                   @default(1) // Number of this card the user owns
  acquiredAt            DateTime              @default(now())
  
  @@unique([userId, cardId])
  @@map("user_inventories")
}

// Transaction model - records all financial transactions
model Transaction {
  id                    String                @id @default(cuid())
  userId                String
  user                  User                  @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type                  String                // "claim", "pack_purchase", "box_purchase", "card_sale"
  amount                Float                 // Amount in dollars
  
  // Optional references based on transaction type
  boxId                 String?
  box                   Box?                  @relation(fields: [boxId], references: [id], onDelete: SetNull)
  packId                String?
  pack                  Pack?                 @relation(fields: [packId], references: [id], onDelete: SetNull)
  cardId                String?
  card                  Card?                 @relation(fields: [cardId], references: [id], onDelete: SetNull)
  
  description           String?               // Human-readable description of the transaction
  createdAt             DateTime              @default(now())
  
  @@map("transactions")
}
