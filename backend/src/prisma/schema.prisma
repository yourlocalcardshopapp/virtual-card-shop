// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Enums for Sports Cards
enum SportType {
  BASEBALL
  FOOTBALL
  BASKETBALL
  HOCKEY
}

enum CardCondition {
  MINT
  NEAR_MINT
  EXCELLENT
  VERY_GOOD
  GOOD
  FAIR
  POOR
}

enum OrderStatus {
  PENDING
  CONFIRMED
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

// Users
model User {
  id        String   @id @default(cuid())
  email     String   @unique
  username  String   @unique
  password  String   // Store hashed password
  fullName  String?
  avatar    String?  // URL to avatar image
  bio       String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  cards         Card[]
  listings      Listing[]
  orders        Order[]
  reviews       Review[]
  favorites     Favorite[]
  notifications Notification[]

  @@map("users")
}

// Sports Cards
model Card {
  id          String     @id @default(cuid())
  title       String
  description String?
  sport       SportType
  player      String     // Player name
  team        String     // Team name
  cardNumber  String     // Card number/set number
  year        Int        // Year of card
  manufacturer String    // e.g., Topps, PSA, etc.
  condition   CardCondition @default(GOOD)
  
  // Card details
  imageUrl    String
  quantity    Int        @default(1)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // Relations
  userId      String
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  listings    Listing[]

  @@index([userId])
  @@index([sport])
  @@map("cards")
}

// Listings for selling cards
model Listing {
  id          String   @id @default(cuid())
  title       String
  description String?
  priceUsd    Float    // Price in USD only
  quantity    Int      @default(1)
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  cardId      String
  card        Card     @relation(fields: [cardId], references: [id], onDelete: Cascade)
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  orderItems  OrderItem[]
  favorites   Favorite[]

  @@index([userId])
  @@index([cardId])
  @@index([active])
  @@map("listings")
}

// Orders
model Order {
  id            String       @id @default(cuid())
  orderNumber   String       @unique
  totalUsd      Float        // Total in USD
  status        OrderStatus  @default(PENDING)
  shippingAddress String
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  // Relations
  userId        String
  user          User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  items         OrderItem[]
  payment       Payment?

  @@index([userId])
  @@index([status])
  @@map("orders")
}

// Order Items (line items in an order)
model OrderItem {
  id          String   @id @default(cuid())
  quantity    Int
  priceUsd    Float    // Price at time of order
  createdAt   DateTime @default(now())

  // Relations
  orderId     String
  order       Order    @relation(fields: [orderId], references: [id], onDelete: Cascade)
  listingId   String
  listing     Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@index([orderId])
  @@index([listingId])
  @@map("order_items")
}

// Simplified Payment Model (USD only)
model Payment {
  id              String        @id @default(cuid())
  amountUsd       Float
  status          PaymentStatus @default(PENDING)
  paymentMethod   String        // e.g., "credit_card", "paypal", "stripe"
  transactionId   String?       // Transaction ID from payment processor
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relations
  orderId         String        @unique
  order           Order         @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@index([status])
  @@map("payments")
}

// Reviews for listings
model Review {
  id          String   @id @default(cuid())
  rating      Int      // 1-5 stars
  comment     String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  // Relations
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  listingId   String

  @@index([userId])
  @@map("reviews")
}

// Favorites/Wishlist
model Favorite {
  id        String   @id @default(cuid())
  createdAt DateTime @default(now())

  // Relations
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id], onDelete: Cascade)

  @@unique([userId, listingId])
  @@index([userId])
  @@map("favorites")
}

// Notifications
model Notification {
  id        String   @id @default(cuid())
  type      String   // e.g., "order_confirmed", "listing_sold", "price_drop"
  message   String
  read      Boolean  @default(false)
  createdAt DateTime @default(now())

  // Relations
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([read])
  @@map("notifications")
}
